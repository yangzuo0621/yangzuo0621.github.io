---
title: 垃圾收集器与内存分配策略
date: 2017-07-30 09:35:20
categories:
- Java
tags:
- 学习笔记
---

Java的垃圾回收机制可以对未使用的对象进行动态回收和管理。了解其背后的运行机制，可以以正确的方式有效的利用进行编程。

### 回收的对象

垃圾回收的对象是那些已经不再使用的对象。如何表示对象已不再使用，存在两种方式：

1. 引用计数。每一个对象都有一个计数器，用来标记其被引用的次数，当计数器为0时，表示对象已不再使用。方法实现简单，但无法解决循环引用的问题。
2. 根可达法。从一个称为`GC Root`的根结点出发，利用图论的知识，根节点不可达的结点表示对象已不再使用。而作为`GC Root`的有如下类型：
  + 方法区中的静态属性引用的对象
  + 方法去中常量引用的对象
  + 本地方法栈中的引用的对象
  + 虚拟机栈中局部变量引用的对象

### 回收的算法

1. 标记-复制。将内存分为两个区域，其中一个区域用于对象的分配，另一个区域用于存放垃圾回收后存活的对象。实现简单，空间利用率低。
2. 标记-清除。标记不再使用的对象，并直接清除掉。导致过多的存在内存碎片，在分配大内存的时候可能会提前导致一个垃圾回收。
3. 标记-整理。将不再使用的对象清除掉，并将存活的对象移动到内存的一端。实现相对复杂，但不会存在内存碎片的问题。

### 虚拟机中分代管理

Java虚拟机根据对象存活的时间，将堆分为新生代和老年代进行分别管理。

新生代中存放的主要是快速产生快速消亡的对象。采用的是`标记-复制`的回收算法。同时进一步将新生代分为一个Eden区，两个Survivor区，默认比例是8:1。对象首先在Eden区进行分配，当Eden区内空间不足时，触发一次Minor GC，将存活的对象以及一个Survivor区的对象全部复制到另一个Survivor区中。因此空间利用率为90%。

老年代主要存放了存活时间较长的对象，以及一些大对象。一般采用`标记-整理`的算法。

### 垃圾收集器

#### 串行收集器

采用一个线程进行垃圾收集工作。Serial, Serial Old，一般用于客户端。

#### 并行收集器

采用多个线程并行进行垃圾收集工作。ParNew，Parallel Savenge，Parallel Old，一般用于服务器端。

#### CMS收集器

并发收集器。初次标记、并发标记、重新标记和并发清除。用于老年代，采用标记-清除算法。

#### G1收集器

G1收集器将堆内存分为多个大小相等独立的区域Region。初始标记、并发标记、最终标记、帅选回收。一般用于服务器端。

PS：欢迎批评指正。
> 参考：深入理解Java虚拟机 —— 垃圾收集器与内存分配策略 第3章%